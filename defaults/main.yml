---
#Default user for asterisk install.
asterisk_user:      asterisk
asterisk_group:     asterisk

asterisk_install_method: source

#Paths for source and cache
data_dir:           "{{asterisk_dir}}"
source_dir:         "{{data_dir}}/source"
cache_dir:          "{{data_dir}}/cache"

#Default configurations, that should be used if no other override is supplied:
dahdi:
  vcs: subversion
  url: http://svn.asterisk.org/svn/dahdi/linux-complete/tags/2.6.1+2.6.1
  dest: "{{source_dir}}/dahdi"
  make: make
  install: make install && make config

libpri:
  vcs: subversion
  url: http://svn.asterisk.org/svn/libpri/tags/1.4.14
  dest: "{{source_dir}}/libpri"
  make: make
  install: make install

#pjproject:
#  vcs: git
#  url: https://github.com/asterisk/pjproject
#  dest: "{{source_dir}}/pjproject"
#  version: master
#  configure: ./configure --with-external-srtp --enable-shared CFLAGS="-DNDEBUG"
#  make: make dep && NDEBUG=1 make
#  install: make install
#
#asterisk:
#  vcs: subversion
#  url: http://svn.asterisk.org/svn/asterisk/trunk
#  dest: "{{source_dir}}/asterisk"
#  configure: ./configure --with-srtp --with-unixodbc --with-pjproject=/usr/local && sed -i "/#undef HAVE_PJ_TRANSACTION_GRP_LOCK/c\#define HAVE_PJ_TRANSACTION_GRP_LOCK=1" include/asterisk/autoconfig.h
#    # include patching step
#  make: curl https://gist.github.com/xytis/7820491/raw | patch -p0 && make
#  install: make install && make config

asterisk:
  vcs: subversion
  url: http://svn.asterisk.org/svn/asterisk/tags/11.5.1
  dest: "{{source_dir}}/asterisk"
  configure: >
    echo "export CFLAGS+= -DNDEBUG" > res/pjproject/user.mak &&
    sed -i 's/MENUSELECT_EXTRA_SOUNDS.*/MENUSELECT_EXTRA_SOUNDS=EXTRA-SOUNDS-EN-WAV EXTRA-SOUNDS-EN-ULAW EXTRA-SOUNDS-EN-ALAW EXTRA-SOUNDS-EN-GSM/' menuselect.makeopts &&
    sed -i 's/MENUSELECT_CORE_SOUNDS.*/MENUSELECT_CORE_SOUNDS=CORE-SOUNDS-EN-WAV CORE-SOUNDS-EN-ULAW CORE-SOUNDS-EN-ALAW CORE-SOUNDS-EN-GSM/' menuselect.makeopts &&
    sed -i 's/MENUSELECT_MOH.*/MENUSELECT_MOH=MOH-OPSOUND-WAV MOH-OPSOUND-ULAW MOH-OPSOUND-ALAW MOH-OPSOUND-GSM/' menuselect.makeopts &&
    ./configure --with-srtp --with-unixodbc &&
    curl https://gist.github.com/xytis/7820491/raw | patch -p0
  make: make
  install: make install && make config

